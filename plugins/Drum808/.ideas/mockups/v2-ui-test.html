<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Drum808 UI Mockup v2</title>

  <style>
    /* ====================================================================
       CRITICAL CSS CONSTRAINTS
       ==================================================================== */

    /* CRITICAL: Use 100%, NOT 100vh */
    html, body {
      height: 100%;  /* NOT 100vh - viewport units break first render */
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    /* ====================================================================
       NATIVE APPLICATION FEEL
       ==================================================================== */

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      /* Disable text selection (this is not a document) */
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;

      /* Disable touch callouts */
      -webkit-touch-callout: none;

      /* Default cursor (not text cursor) */
      cursor: default;

      /* Disable text highlighting on tap */
      -webkit-tap-highlight-color: transparent;

      /* Brushed metal background */
      background: linear-gradient(135deg, #b8b8b8 0%, #c0c0c0 50%, #b8b8b8 100%);
      font-family: Arial, Helvetica, sans-serif;
      color: #ffffff;
    }

    /* ====================================================================
       LAYOUT
       ==================================================================== */

    .container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: row;
    }

    /* Channel strip styling */
    .channel {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 10px;
      border-right: 1px solid #8a8a8a;
      background: linear-gradient(180deg, #c0c0c0 0%, #b0b0b0 100%);
    }

    .channel:last-child {
      border-right: none;
    }

    /* Drum name label */
    .drum-name {
      font-size: 14px;
      font-weight: bold;
      letter-spacing: 2px;
      margin-bottom: 15px;
      text-transform: uppercase;
      color: #ffffff;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    /* LED indicator */
    .led {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #2a2a2a;
      border: 2px solid #4a4a4a;
      margin-bottom: 20px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6);
      transition: background 0.1s ease, box-shadow 0.1s ease;
    }

    .led.active {
      background: #ff4500;
      box-shadow: 0 0 12px #ff4500, inset 0 2px 4px rgba(255, 69, 0, 0.6);
    }

    /* Knob container */
    .knob-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 15px;
      width: 100%;
    }

    .knob-wrapper {
      position: relative;
      width: 60px;
      height: 60px;
      margin-bottom: 5px;
    }

    .knob-canvas {
      cursor: pointer;
    }

    /* Knob label */
    .knob-label {
      font-size: 11px;
      font-weight: bold;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #e0e0e0;
      text-align: center;
      text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
    }

    /* Value display */
    .knob-value {
      font-size: 10px;
      color: #d0d0d0;
      margin-top: 2px;
      text-align: center;
    }

    /* Debug info */
    .debug-info {
      position: fixed;
      bottom: 10px;
      left: 10px;
      font-size: 11px;
      color: #333;
      font-family: monospace;
      background: rgba(255, 255, 255, 0.8);
      padding: 5px 10px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- KICK CHANNEL -->
    <div class="channel">
      <div class="drum-name">KICK</div>
      <div class="led" id="kick-led"></div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="kick-level-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">LEVEL</div>
        <div class="knob-value" id="kick-level-value">80%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="kick-tone-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TONE</div>
        <div class="knob-value" id="kick-tone-value">50%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="kick-decay-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">DECAY</div>
        <div class="knob-value" id="kick-decay-value">400ms</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="kick-tuning-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TUNING</div>
        <div class="knob-value" id="kick-tuning-value">0st</div>
      </div>
    </div>

    <!-- LOW TOM CHANNEL -->
    <div class="channel">
      <div class="drum-name">LOW TOM</div>
      <div class="led" id="lowtom-led"></div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="lowtom-level-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">LEVEL</div>
        <div class="knob-value" id="lowtom-level-value">75%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="lowtom-tone-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TONE</div>
        <div class="knob-value" id="lowtom-tone-value">50%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="lowtom-decay-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">DECAY</div>
        <div class="knob-value" id="lowtom-decay-value">300ms</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="lowtom-tuning-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TUNING</div>
        <div class="knob-value" id="lowtom-tuning-value">0st</div>
      </div>
    </div>

    <!-- MID TOM CHANNEL -->
    <div class="channel">
      <div class="drum-name">MID TOM</div>
      <div class="led" id="midtom-led"></div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="midtom-level-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">LEVEL</div>
        <div class="knob-value" id="midtom-level-value">75%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="midtom-tone-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TONE</div>
        <div class="knob-value" id="midtom-tone-value">50%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="midtom-decay-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">DECAY</div>
        <div class="knob-value" id="midtom-decay-value">250ms</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="midtom-tuning-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TUNING</div>
        <div class="knob-value" id="midtom-tuning-value">+5st</div>
      </div>
    </div>

    <!-- CLAP CHANNEL (uses SNAP instead of DECAY) -->
    <div class="channel">
      <div class="drum-name">CLAP</div>
      <div class="led" id="clap-led"></div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="clap-level-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">LEVEL</div>
        <div class="knob-value" id="clap-level-value">70%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="clap-tone-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TONE</div>
        <div class="knob-value" id="clap-tone-value">50%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="clap-snap-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">SNAP</div>
        <div class="knob-value" id="clap-snap-value">60%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="clap-tuning-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TUNING</div>
        <div class="knob-value" id="clap-tuning-value">0st</div>
      </div>
    </div>

    <!-- CLOSED HAT CHANNEL -->
    <div class="channel">
      <div class="drum-name">CLOSED HAT</div>
      <div class="led" id="closedhat-led"></div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="closedhat-level-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">LEVEL</div>
        <div class="knob-value" id="closedhat-level-value">65%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="closedhat-tone-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TONE</div>
        <div class="knob-value" id="closedhat-tone-value">60%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="closedhat-decay-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">DECAY</div>
        <div class="knob-value" id="closedhat-decay-value">80ms</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="closedhat-tuning-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TUNING</div>
        <div class="knob-value" id="closedhat-tuning-value">0st</div>
      </div>
    </div>

    <!-- OPEN HAT CHANNEL -->
    <div class="channel">
      <div class="drum-name">OPEN HAT</div>
      <div class="led" id="openhat-led"></div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="openhat-level-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">LEVEL</div>
        <div class="knob-value" id="openhat-level-value">60%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="openhat-tone-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TONE</div>
        <div class="knob-value" id="openhat-tone-value">60%</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="openhat-decay-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">DECAY</div>
        <div class="knob-value" id="openhat-decay-value">500ms</div>
      </div>

      <div class="knob-group">
        <div class="knob-wrapper">
          <canvas class="knob-canvas" id="openhat-tuning-knob" width="60" height="60"></canvas>
        </div>
        <div class="knob-label">TUNING</div>
        <div class="knob-value" id="openhat-tuning-value">0st</div>
      </div>
    </div>
  </div>

  <div class="debug-info">
    Browser Test Mode | Drag knobs to test | Press 1-6 to trigger LEDs
  </div>

  <script>
    // ====================================================================
    // MOCK JUCE BACKEND (for browser testing only)
    // ====================================================================

    class MockSliderState {
      constructor(paramId, min, max, defaultValue) {
        this.paramId = paramId;
        this.min = min;
        this.max = max;
        this.value = defaultValue;
        this.listeners = [];
      }

      getNormalisedValue() {
        return (this.value - this.min) / (this.max - this.min);
      }

      setNormalisedValue(normalizedValue) {
        this.value = this.min + normalizedValue * (this.max - this.min);
        this.listeners.forEach(listener => listener(normalizedValue));
        console.log(`[MOCK] ${this.paramId} set to ${this.value.toFixed(2)} (normalized: ${normalizedValue.toFixed(3)})`);
      }

      get valueChangedEvent() {
        return {
          addListener: (callback) => {
            this.listeners.push(callback);
          }
        };
      }
    }

    // Create mock JUCE backend
    const mockBackend = {
      'kick_level': new MockSliderState('kick_level', 0, 100, 80),
      'kick_tone': new MockSliderState('kick_tone', 0, 100, 50),
      'kick_decay': new MockSliderState('kick_decay', 50, 1000, 400),
      'kick_tuning': new MockSliderState('kick_tuning', -12, 12, 0),
      'lowtom_level': new MockSliderState('lowtom_level', 0, 100, 75),
      'lowtom_tone': new MockSliderState('lowtom_tone', 0, 100, 50),
      'lowtom_decay': new MockSliderState('lowtom_decay', 50, 1000, 300),
      'lowtom_tuning': new MockSliderState('lowtom_tuning', -12, 12, 0),
      'midtom_level': new MockSliderState('midtom_level', 0, 100, 75),
      'midtom_tone': new MockSliderState('midtom_tone', 0, 100, 50),
      'midtom_decay': new MockSliderState('midtom_decay', 50, 1000, 250),
      'midtom_tuning': new MockSliderState('midtom_tuning', -12, 12, 5),
      'clap_level': new MockSliderState('clap_level', 0, 100, 70),
      'clap_tone': new MockSliderState('clap_tone', 0, 100, 50),
      'clap_snap': new MockSliderState('clap_snap', 0, 100, 60),
      'clap_tuning': new MockSliderState('clap_tuning', -12, 12, 0),
      'closedhat_level': new MockSliderState('closedhat_level', 0, 100, 65),
      'closedhat_tone': new MockSliderState('closedhat_tone', 0, 100, 60),
      'closedhat_decay': new MockSliderState('closedhat_decay', 20, 200, 80),
      'closedhat_tuning': new MockSliderState('closedhat_tuning', -12, 12, 0),
      'openhat_level': new MockSliderState('openhat_level', 0, 100, 60),
      'openhat_tone': new MockSliderState('openhat_tone', 0, 100, 60),
      'openhat_decay': new MockSliderState('openhat_decay', 100, 1000, 500),
      'openhat_tuning': new MockSliderState('openhat_tuning', -12, 12, 0)
    };

    window.__JUCE__ = {
      backend: "mock",
      getSliderState: (paramId) => {
        if (mockBackend[paramId]) {
          return mockBackend[paramId];
        }
        throw new Error(`Unknown parameter: ${paramId}`);
      }
    };

    // ====================================================================
    // NATIVE APPLICATION FEEL (JavaScript)
    // ====================================================================

    // Disable right-click context menu
    document.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      return false;
    });

    // Disable default drag behaviors
    document.addEventListener("dragstart", (e) => {
      e.preventDefault();
    });

    // ====================================================================
    // ROTARY KNOB IMPLEMENTATION
    // ====================================================================

    class RotaryKnob {
      constructor(canvas, paramState, config) {
        this.canvas = canvas;
        this.ctx = canvas.getContext("2d");
        this.paramState = paramState;
        this.config = {
          min: config.min || 0,
          max: config.max || 1,
          unit: config.unit || "",
          decimals: config.decimals || 0,
          valueDisplay: config.valueDisplay || null,
          formatValue: config.formatValue || ((v) => Math.round(v)),
          ...config
        };

        this.isDragging = false;
        this.startY = 0;
        this.startValue = 0;

        this.setupEventListeners();
        this.render();
      }

      setupEventListeners() {
        // Mouse events
        this.canvas.addEventListener("mousedown", (e) => {
          this.isDragging = true;
          this.startY = e.clientY;
          this.startValue = this.paramState.getNormalisedValue();
          this.canvas.style.cursor = "grabbing";
        });

        document.addEventListener("mousemove", (e) => {
          if (!this.isDragging) return;

          const delta = (this.startY - e.clientY) / 100; // Sensitivity
          const newValue = Math.max(0, Math.min(1, this.startValue + delta));

          this.paramState.setNormalisedValue(newValue);
          this.render();
          this.updateValueDisplay();
        });

        document.addEventListener("mouseup", () => {
          if (this.isDragging) {
            this.isDragging = false;
            this.canvas.style.cursor = "pointer";
          }
        });

        // Listen for external parameter changes
        this.paramState.valueChangedEvent.addListener((normalizedValue) => {
          this.render();
          this.updateValueDisplay();
        });
      }

      render() {
        const ctx = this.ctx;
        const width = this.canvas.width;
        const height = this.canvas.height;
        const centerX = width / 2;
        const centerY = height / 2;
        const radius = 24;

        // Clear canvas
        ctx.clearRect(0, 0, width, height);

        // Get normalized value
        const normalizedValue = this.paramState.getNormalisedValue();

        // Calculate rotation angle (270 degrees of rotation)
        const startAngle = (135 * Math.PI) / 180; // Start at 7:30
        const endAngle = (45 * Math.PI) / 180;   // End at 4:30
        const totalRotation = endAngle - startAngle + 2 * Math.PI;
        const currentAngle = startAngle + normalizedValue * totalRotation;

        // Draw track (background arc)
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, startAngle + totalRotation);
        ctx.strokeStyle = "#1a1a1a";
        ctx.lineWidth = 4;
        ctx.lineCap = "round";
        ctx.stroke();

        // Draw filled arc (value indicator)
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, startAngle, currentAngle);
        ctx.strokeStyle = "#4a9eff";
        ctx.lineWidth = 4;
        ctx.lineCap = "round";
        ctx.stroke();

        // Draw center circle
        ctx.beginPath();
        ctx.arc(centerX, centerY, 18, 0, 2 * Math.PI);
        ctx.fillStyle = "#2a2a2a";
        ctx.fill();

        // Draw position indicator line
        const indicatorLength = 12;
        const indicatorX = centerX + Math.cos(currentAngle) * indicatorLength;
        const indicatorY = centerY + Math.sin(currentAngle) * indicatorLength;

        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(indicatorX, indicatorY);
        ctx.strokeStyle = "#ffffff";
        ctx.lineWidth = 2;
        ctx.lineCap = "round";
        ctx.stroke();
      }

      updateValueDisplay() {
        if (!this.config.valueDisplay) return;

        const actualValue = this.config.min +
          this.paramState.getNormalisedValue() * (this.config.max - this.config.min);

        const displayText = this.config.formatValue(actualValue) + this.config.unit;
        this.config.valueDisplay.textContent = displayText;
      }
    }

    // ====================================================================
    // PARAMETER BINDING
    // ====================================================================

    // Verify JUCE backend is connected
    if (!window.__JUCE__) {
      console.error("JUCE backend not available");
      document.body.innerHTML = "<h1>Error: JUCE backend not connected</h1>";
      throw new Error("JUCE backend not connected");
    }

    console.log("JUCE backend connected:", window.__JUCE__.backend);

    // Helper to create knob
    function createKnob(paramId, canvasId, valueId, min, max, defaultVal, unit, formatFn) {
      const canvas = document.getElementById(canvasId);
      const valueDisplay = document.getElementById(valueId);
      const state = window.__JUCE__.getSliderState(paramId);

      const knob = new RotaryKnob(canvas, state, {
        min: min,
        max: max,
        unit: unit,
        valueDisplay: valueDisplay,
        formatValue: formatFn || ((v) => Math.round(v))
      });

      knob.updateValueDisplay();
      return knob;
    }

    // Format tuning with +/- sign
    function formatTuning(v) {
      const rounded = Math.round(v);
      return rounded > 0 ? `+${rounded}` : `${rounded}`;
    }

    // Format percentage
    function formatPercent(v) {
      return Math.round(v);
    }

    // Format milliseconds
    function formatMs(v) {
      return Math.round(v);
    }

    // Create all knobs
    // KICK
    createKnob('kick_level', 'kick-level-knob', 'kick-level-value', 0, 100, 80, '%', formatPercent);
    createKnob('kick_tone', 'kick-tone-knob', 'kick-tone-value', 0, 100, 50, '%', formatPercent);
    createKnob('kick_decay', 'kick-decay-knob', 'kick-decay-value', 50, 1000, 400, 'ms', formatMs);
    createKnob('kick_tuning', 'kick-tuning-knob', 'kick-tuning-value', -12, 12, 0, 'st', formatTuning);

    // LOW TOM
    createKnob('lowtom_level', 'lowtom-level-knob', 'lowtom-level-value', 0, 100, 75, '%', formatPercent);
    createKnob('lowtom_tone', 'lowtom-tone-knob', 'lowtom-tone-value', 0, 100, 50, '%', formatPercent);
    createKnob('lowtom_decay', 'lowtom-decay-knob', 'lowtom-decay-value', 50, 1000, 300, 'ms', formatMs);
    createKnob('lowtom_tuning', 'lowtom-tuning-knob', 'lowtom-tuning-value', -12, 12, 0, 'st', formatTuning);

    // MID TOM
    createKnob('midtom_level', 'midtom-level-knob', 'midtom-level-value', 0, 100, 75, '%', formatPercent);
    createKnob('midtom_tone', 'midtom-tone-knob', 'midtom-tone-value', 0, 100, 50, '%', formatPercent);
    createKnob('midtom_decay', 'midtom-decay-knob', 'midtom-decay-value', 50, 1000, 250, 'ms', formatMs);
    createKnob('midtom_tuning', 'midtom-tuning-knob', 'midtom-tuning-value', -12, 12, 5, 'st', formatTuning);

    // CLAP
    createKnob('clap_level', 'clap-level-knob', 'clap-level-value', 0, 100, 70, '%', formatPercent);
    createKnob('clap_tone', 'clap-tone-knob', 'clap-tone-value', 0, 100, 50, '%', formatPercent);
    createKnob('clap_snap', 'clap-snap-knob', 'clap-snap-value', 0, 100, 60, '%', formatPercent);
    createKnob('clap_tuning', 'clap-tuning-knob', 'clap-tuning-value', -12, 12, 0, 'st', formatTuning);

    // CLOSED HAT
    createKnob('closedhat_level', 'closedhat-level-knob', 'closedhat-level-value', 0, 100, 65, '%', formatPercent);
    createKnob('closedhat_tone', 'closedhat-tone-knob', 'closedhat-tone-value', 0, 100, 60, '%', formatPercent);
    createKnob('closedhat_decay', 'closedhat-decay-knob', 'closedhat-decay-value', 20, 200, 80, 'ms', formatMs);
    createKnob('closedhat_tuning', 'closedhat-tuning-knob', 'closedhat-tuning-value', -12, 12, 0, 'st', formatTuning);

    // OPEN HAT
    createKnob('openhat_level', 'openhat-level-knob', 'openhat-level-value', 0, 100, 60, '%', formatPercent);
    createKnob('openhat_tone', 'openhat-tone-knob', 'openhat-tone-value', 0, 100, 60, '%', formatPercent);
    createKnob('openhat_decay', 'openhat-decay-knob', 'openhat-decay-value', 100, 1000, 500, 'ms', formatMs);
    createKnob('openhat_tuning', 'openhat-tuning-knob', 'openhat-tuning-value', -12, 12, 0, 'st', formatTuning);

    // LED trigger simulation (keyboard shortcuts)
    const ledMap = {
      '1': 'kick-led',
      '2': 'lowtom-led',
      '3': 'midtom-led',
      '4': 'clap-led',
      '5': 'closedhat-led',
      '6': 'openhat-led'
    };

    document.addEventListener('keydown', (e) => {
      const ledId = ledMap[e.key];
      if (ledId) {
        const led = document.getElementById(ledId);
        led.classList.add('active');
        setTimeout(() => led.classList.remove('active'), 150);
      }
    });

    // ====================================================================
    // INITIALIZATION COMPLETE
    // ====================================================================

    console.log("Drum808 UI v2 initialized (browser test mode)");
  </script>
</body>
</html>
