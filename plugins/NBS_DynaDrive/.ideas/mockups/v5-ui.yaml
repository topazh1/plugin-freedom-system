---
# NBS DynaDrive — UI Design Specification v5
# Generated: 2026-02-27
# Agent: manual-fix
# Changes from v4:
#   1. Added Post-Saturation Tilt filter (Freq + Slope knobs, red accent)
#   2. Added Post-Dynamics Tilt filter (Freq + Slope knobs, blue accent)
#   3. Advanced panel height increased to 260px for new controls

plugin:
  name: NBS_DynaDrive
  display_name: "NBS DynaDrive"
  type: "saturation + dynamics processor"
  version: "1.0.0"
  tagline: "Clean saturation without aliasing — Neve warmth, API dynamics"

window:
  main_width: 740
  main_height: 420
  expanded_width: 740
  expanded_height: 680
  resizable: false
  default_state: collapsed

finalization_marker: false

# ─────────────────────────────────────────────
# COLOR SYSTEM
# ─────────────────────────────────────────────
color_system:
  background: "#141414"
  panel_surface: "#1e1e1e"
  section_divider: "#2a2a2a"
  accent_saturation: "#c0392b"
  accent_dynamics: "#4a90d9"
  accent_neutral: "#888888"
  text_primary: "#e8e8e8"
  text_secondary: "#888888"
  knob_body: "#1a1a1a"
  meter_green_low: "#22c55e"
  meter_green_high: "#16a34a"
  meter_amber: "#f59e0b"
  meter_red: "#ef4444"
  meter_orange: "#f97316"
  meter_inactive: "#2a2a2a"
  display_bg: "#0e0e0e"

# ─────────────────────────────────────────────
# CONTROL STYLE
# ─────────────────────────────────────────────
control_style:
  knob_type: "backlit_arc"
  description: >
    Dark circular body (#1a1a1a) with subtle drop shadow. A glowing SVG arc
    indicator ring sweeps 270 degrees around the knob showing current value.
    Arc color corresponds to section: red for saturation, blue for dynamics,
    gray for utility. Small dot indicator on knob face. Label below in #888
    at 11px. Value readout below label in 10px dimmer text. Interactive:
    click-drag vertical to adjust, double-click to reset.
  arc_sweep_degrees: 270
  arc_start_angle: 135
  arc_end_angle: 45
  circle_fill_knobs:
    type: "full_circle_fill"
    applies_to: ["input", "mix", "output"]
    description: >
      Input, Mix, and Output knobs use a 360° fill indicator instead of standard
      270° arc. At 0% (or min) the ring is empty/dim; at 100% (or max) the full
      circle is lit. Arc fills clockwise from 12 o'clock.
    arc_sweep_degrees: 360
    fill_direction: "clockwise_from_top"

# ─────────────────────────────────────────────
# LAYOUT SECTIONS (v2 — updated heights for graphs)
# ─────────────────────────────────────────────
layout_sections:
  saturation:
    label: "SATURATION"
    label_color: "#c0392b"
    x: 20
    y: 0
    width: 210
    height: 380
    accent: "#c0392b"
    note: "Extended height to accommodate drive curve display below EVEN/ODD knobs"

  center:
    label: "NBS DynaDrive"
    x: 248
    y: 0
    width: 244
    height: 380
    accent: "#888888"
    note: "v2 layout: title → pill toggle → INPUT/MIX/OUTPUT row"

  dynamics:
    label: "DYNAMICS"
    label_color: "#4a90d9"
    x: 510
    y: 0
    width: 170
    height: 380
    accent: "#4a90d9"
    note: "Extended height to accommodate dynamics curve display below UP/DOWN knobs"

  metering:
    x: 692
    y: 10
    width: 82
    height: 380
    note: "v4: stereo meters side by side — IN (L/R) + OUT (L/R) horizontal"

  advanced_toggle_bar:
    x: 0
    y: 390
    width: 740
    height: 30

  advanced_panel:
    x: 0
    y: 420
    width: 740
    height: 260
    collapsible: true
    default: collapsed
    note: "v5: expanded to 260px for tilt filter controls"

# ─────────────────────────────────────────────
# PARAMETERS / CONTROLS
# ─────────────────────────────────────────────
controls:

  # ── SATURATION SECTION ──────────────────────

  - id: drive
    label: "DRIVE"
    type: slider
    section: saturation
    accent: "#c0392b"
    range: [0.0, 100.0]
    default: 20.0
    unit: "%"
    size:
      diameter: 55
    position:
      x: 50
      y: 45
    knob_size: large
    description: "Primary saturation input drive"

  - id: even
    label: "EVEN"
    type: slider
    section: saturation
    accent: "#c0392b"
    range: [0.0, 100.0]
    default: 0.0
    unit: "%"
    size:
      diameter: 40
    position:
      x: 30
      y: 150
    knob_size: medium
    description: "Even harmonic content (2nd/4th order)"

  - id: odd
    label: "ODD"
    type: slider
    section: saturation
    accent: "#c0392b"
    range: [0.0, 100.0]
    default: 0.0
    unit: "%"
    size:
      diameter: 40
    position:
      x: 120
      y: 150
    knob_size: medium
    description: "Odd harmonic content (3rd/5th order)"

  # ── CENTER SECTION — v2 revised ──────────────

  - id: pre_post
    label: "SIGNAL FLOW"
    type: toggle
    section: center
    accent: "#4a90d9"
    range: [0, 1]
    default: 0
    values: ["DYN→SAT", "SAT→DYN"]
    size:
      width: 120
      height: 36
    position:
      x: 309
      y: 150
    style:
      border_radius: "50px"
      dyn_sat_bg: "#4a90d9"
      dyn_sat_text: "#ffffff"
      dyn_sat_glow: "0 0 14px rgba(74, 144, 217, 0.45)"
      sat_dyn_bg: "#8b1a1a"
      sat_dyn_text: "#ffffff"
      sat_dyn_glow: "0 0 14px rgba(192, 57, 43, 0.40)"
      idle_bg: "#2a2a2a"
      idle_text: "#888888"
      transition: "all 150ms ease"
    description: "Pre/post routing — blue (DYN→SAT) / dark red (SAT→DYN)"

  - id: input
    label: "INPUT"
    type: slider
    section: center
    accent: "#888888"
    range: [-48.0, 10.0]
    default: 0.0
    unit: "dB"
    size:
      diameter: 35
    position:
      x: 265
      y: 245
    knob_size: small
    indicator_style: "full_circle_fill"
    description: "Input gain before all processing — 360° circle indicator"

  - id: mix
    label: "MIX"
    type: slider
    section: center
    accent: "#888888"
    range: [0.0, 100.0]
    default: 100.0
    unit: "%"
    size:
      diameter: 35
    position:
      x: 352
      y: 245
    knob_size: small
    indicator_style: "full_circle_fill"
    indicator_description: >
      360° fill indicator. Arc fills clockwise from 12 o'clock.
      Empty ring at 0%; fully lit complete circle at 100%.
      Color: #888888 arc on #2a2a2a dim ring. Visually distinct from all
      other 270° arc knobs — communicates wet/dry blend as a fill level.
    description: "Dry/wet parallel blend — full 360° circle indicator"

  - id: output
    label: "OUTPUT"
    type: slider
    section: center
    accent: "#888888"
    range: [-48.0, 10.0]
    default: 0.0
    unit: "dB"
    size:
      diameter: 35
    position:
      x: 440
      y: 245
    knob_size: small
    indicator_style: "full_circle_fill"
    description: "Output gain / makeup gain — 360° circle indicator"

  # ── DYNAMICS SECTION ─────────────────────────

  - id: dynamics
    label: "DYNAMICS"
    type: slider
    section: dynamics
    accent: "#4a90d9"
    range: [0.0, 100.0]
    default: 30.0
    unit: "%"
    size:
      diameter: 55
    position:
      x: 538
      y: 45
    knob_size: large
    description: "Macro dynamics control (upward + downward compression)"

  - id: up
    label: "UP"
    type: slider
    section: dynamics
    accent: "#4a90d9"
    range: [0.0, 100.0]
    default: 0.0
    unit: "%"
    size:
      diameter: 35
    position:
      x: 522
      y: 150
    knob_size: small
    description: "Upward compression amount"

  - id: down
    label: "DOWN"
    type: slider
    section: dynamics
    accent: "#4a90d9"
    range: [0.0, 100.0]
    default: 50.0
    unit: "%"
    size:
      diameter: 35
    position:
      x: 617
      y: 150
    knob_size: small
    description: "Downward compression amount"

  # ── ADVANCED PANEL — DYNAMICS DETAIL ─────────

  - id: threshold
    label: "THRESHOLD"
    type: slider
    section: advanced_dynamics
    accent: "#4a90d9"
    range: [-40.0, 0.0]
    default: -18.0
    unit: "dB"
    size:
      diameter: 40
    position:
      x: 35
      y: 465
    knob_size: medium
    description: "Compressor threshold"

  - id: ratio
    label: "RATIO"
    type: slider
    section: advanced_dynamics
    accent: "#4a90d9"
    range: [1.0, 10.0]
    default: 4.0
    unit: ":1"
    size:
      diameter: 40
    position:
      x: 110
      y: 465
    knob_size: medium
    description: "Compression ratio"

  - id: attack_time
    label: "ATTACK"
    type: slider
    section: advanced_dynamics
    accent: "#4a90d9"
    range: [0.1, 100.0]
    default: 10.0
    unit: "ms"
    size:
      diameter: 40
    position:
      x: 185
      y: 465
    knob_size: medium
    description: "Attack time (default: program-dependent Auto)"

  - id: release_time
    label: "RELEASE"
    type: slider
    section: advanced_dynamics
    accent: "#4a90d9"
    range: [10.0, 1000.0]
    default: 100.0
    unit: "ms"
    size:
      diameter: 40
    position:
      x: 260
      y: 465
    knob_size: medium
    description: "Release time (default: program-dependent Auto)"

  # ── ADVANCED PANEL — SATURATION + M/S ────────

  - id: h_curve
    label: "SHAPE"
    type: slider
    section: advanced_saturation
    accent: "#c0392b"
    range: [0.0, 100.0]
    default: 50.0
    unit: "%"
    size:
      diameter: 40
    position:
      x: 490
      y: 455
    knob_size: medium
    display_labels: ["Soft", "Medium", "Hard"]
    display_thresholds: [25, 75]
    description: "Saturation curve shape — continuous variable (Soft → Medium → Hard)"

  # ── ADVANCED PANEL — POST-SAT TILT ──────────

  - id: sat_tilt_freq
    label: "FREQ"
    type: slider
    section: advanced_tilt_sat
    accent: "#c0392b"
    range: [100.0, 10000.0]
    default: 1000.0
    unit: "Hz"
    size:
      diameter: 35
    knob_size: small
    display_format: "frequency"
    description: "Post-saturation tilt filter center frequency (100 Hz – 10 kHz)"

  - id: sat_tilt_slope
    label: "SLOPE"
    type: slider
    section: advanced_tilt_sat
    accent: "#c0392b"
    range: [-6.0, 6.0]
    default: 0.0
    unit: "dB/oct"
    size:
      diameter: 35
    knob_size: small
    description: "Post-saturation tilt slope (-6 dark / 0 flat / +6 bright)"

  # ── ADVANCED PANEL — POST-DYN TILT ──────────

  - id: dyn_tilt_freq
    label: "FREQ"
    type: slider
    section: advanced_tilt_dyn
    accent: "#4a90d9"
    range: [100.0, 10000.0]
    default: 1000.0
    unit: "Hz"
    size:
      diameter: 35
    knob_size: small
    display_format: "frequency"
    description: "Post-dynamics tilt filter center frequency (100 Hz – 10 kHz)"

  - id: dyn_tilt_slope
    label: "SLOPE"
    type: slider
    section: advanced_tilt_dyn
    accent: "#4a90d9"
    range: [-6.0, 6.0]
    default: 0.0
    unit: "dB/oct"
    size:
      diameter: 35
    knob_size: small
    description: "Post-dynamics tilt slope (-6 dark / 0 flat / +6 bright)"

  # ── ADVANCED PANEL — M/S ────────────────────

  - id: ms_enable
    label: "M/S MODE"
    type: toggle
    section: advanced_ms
    accent: "#888888"
    range: [0, 1]
    default: 0
    values: ["STEREO", "M/S"]
    size:
      width: 100
      height: 28
    position:
      x: 490
      y: 505
    description: "Enable mid/side processing mode"

  - id: mid_drive
    label: "MID"
    type: slider
    section: advanced_ms
    accent: "#888888"
    range: [0.0, 100.0]
    default: 50.0
    unit: "%"
    size:
      diameter: 35
    position:
      x: 490
      y: 550
    knob_size: small
    description: "Independent mid channel saturation (visible when M/S enabled)"
    visible_when: "ms_enable == 1"

  - id: side_drive
    label: "SIDE"
    type: slider
    section: advanced_ms
    accent: "#888888"
    range: [0.0, 100.0]
    default: 50.0
    unit: "%"
    size:
      diameter: 35
    position:
      x: 570
      y: 550
    knob_size: small
    description: "Independent side channel saturation (visible when M/S enabled)"
    visible_when: "ms_enable == 1"

# ─────────────────────────────────────────────
# VISUAL DISPLAYS (v2 new)
# ─────────────────────────────────────────────
visual_displays:

  - id: drive_curve
    label: "DRIVE CURVE"
    type: svg_transfer_curve
    section: saturation
    position:
      x: 22
      y: 258
    size:
      width: 170
      height: 90
    style:
      background: "#0e0e0e"
      border: "1px solid rgba(192, 57, 43, 0.30)"
      box_shadow: "inset 0 0 8px rgba(192, 57, 43, 0.08)"
      grid_color: "#2a2a2a"
      curve_color: "#c0392b"
      curve_glow: "0 0 6px rgba(192, 57, 43, 0.6)"
      label_color: "#c0392b"
      label_size: "9px"
    reactive_to: ["drive", "even", "odd"]
    description: >
      SVG transfer function display. X = input level (-1 to +1), Y = output level.
      Curve updates in real-time as DRIVE, EVEN, ODD knobs change.
      Shows soft-clip curve; EVEN introduces asymmetry; ODD intensifies symmetric clip.
    curve_math: |
      function computeTransferCurve(drive, even, odd) {
        const d = drive / 100;
        const e = even / 100;
        const o = odd / 100;
        return x => {
          const driven = x * (1 + d * 3);
          const softclip = driven / (1 + Math.abs(driven));
          const evenShift = e * 0.3 * (x * x);
          const oddClip = o * 0.2 * (driven * driven * driven) / (1 + driven * driven);
          return Math.max(-1, Math.min(1, softclip + evenShift - oddClip));
        };
      }

  - id: dyn_curve
    label: "DYN CURVE"
    type: svg_compressor_curve
    section: dynamics
    position:
      x: 512
      y: 258
    size:
      width: 150
      height: 90
    style:
      background: "#0e0e0e"
      border: "1px solid rgba(74, 144, 217, 0.30)"
      box_shadow: "inset 0 0 8px rgba(74, 144, 217, 0.08)"
      grid_color: "#2a2a2a"
      curve_color: "#4a90d9"
      curve_glow: "0 0 6px rgba(74, 144, 217, 0.6)"
      label_color: "#4a90d9"
      label_size: "9px"
    reactive_to: ["threshold", "ratio", "dynamics", "up", "down"]
    description: >
      SVG compressor transfer function display. X = input dB (-60 to 0), Y = output dB.
      Shows both upward (below threshold) and downward (above threshold) compression.
      Knee width driven by DYNAMICS macro. UP knob raises quiet signals toward threshold.
      DOWN knob scales the compression ratio for downward compression.
    curve_math: |
      function computeCompressorCurve(threshold, ratio, dynamics, up, down) {
        const kneeWidth = 6 * (dynamics / 100);
        const downRatio = 1 + (ratio - 1) * (down / 100);
        const upRatio = 1 + (up / 100) * 3;
        return inputDb => {
          let outputDb = inputDb;
          // Downward compression (above threshold)
          if (downRatio > 1.001) {
            const kneeLow = threshold - kneeWidth / 2;
            const kneeHigh = threshold + kneeWidth / 2;
            if (inputDb > kneeHigh) {
              outputDb = threshold + (inputDb - threshold) / downRatio;
            } else if (inputDb > kneeLow) {
              const t = (inputDb - kneeLow) / kneeWidth;
              outputDb = inputDb + (1 / downRatio - 1) * t * t * kneeWidth / 2;
            }
          }
          // Upward compression (below threshold)
          if (upRatio > 1.001 && inputDb < threshold) {
            const below = threshold - inputDb;
            outputDb = threshold - below / upRatio;
          }
          return Math.max(-60, Math.min(0, outputDb));
        };
      }

# ─────────────────────────────────────────────
# METERING
# ─────────────────────────────────────────────
meters:
  layout: horizontal
  note: "IN (L/R) and OUT (L/R) placed side by side horizontally"

  - id: input_meter_stereo
    label: "IN"
    type: stereo_pair
    channels: ["L", "R"]
    size:
      bar_width: 8
      bar_height: 340
      gap: 2
    direction: "bottom_to_top"
    color_zones:
      - range: [0, 70]
        color: "#22c55e"
      - range: [70, 85]
        color: "#f59e0b"
      - range: [85, 100]
        color: "#ef4444"

  - id: output_meter_stereo
    label: "OUT"
    type: stereo_pair
    channels: ["L", "R"]
    size:
      bar_width: 8
      bar_height: 340
      gap: 2
    direction: "bottom_to_top"
    color_zones:
      - range: [0, 70]
        color: "#22c55e"
      - range: [70, 85]
        color: "#f59e0b"
      - range: [85, 100]
        color: "#ef4444"

# ─────────────────────────────────────────────
# TYPOGRAPHY
# ─────────────────────────────────────────────
typography:
  font_stack: "'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"
  plugin_name:
    size: 18px
    weight: 600
    color: "#e8e8e8"
    letter_spacing: "0.08em"
  section_label:
    size: 10px
    weight: 700
    color: "section accent"
    letter_spacing: "0.15em"
    text_transform: uppercase
  knob_label:
    size: 11px
    weight: 500
    color: "#888888"
    letter_spacing: "0.1em"
  knob_value:
    size: 10px
    weight: 400
    color: "#555555"
  display_label:
    size: 9px
    weight: 600
    letter_spacing: "0.12em"
    text_transform: uppercase
  advanced_note:
    size: 10px
    style: italic
    color: "#555555"

# ─────────────────────────────────────────────
# V5 CHANGE LOG
# ─────────────────────────────────────────────
v5_changes:
  - change: 1
    description: "Post-Saturation Tilt: added FREQ (100Hz-10kHz) + SLOPE (-6 to +6 dB) knobs, red accent"
  - change: 2
    description: "Post-Dynamics Tilt: added FREQ (100Hz-10kHz) + SLOPE (-6 to +6 dB) knobs, blue accent"
  - change: 3
    description: "Advanced panel height increased from 220px to 260px"
  - note: "Total parameter count now 19 interactive + 2 visual displays + 2 toggles"
